    def fetch_po_lines_by_docentry(self, doc_entry):
        """
        Fetch Purchase Order details including line items by DocEntry using $crossjoin
        URL: /b1s/v1/$crossjoin(PurchaseOrders,PurchaseOrders/DocumentLines)?$expand=...&$filter=...DocEntry eq X
        Returns full PO details with DocumentLines in the $crossjoin response format
        """
        if self.enable_mock_data:
            logging.info(f"üìã Using mock PO lines for DocEntry {doc_entry} (ENABLE_MOCK_SAP_DATA=true)")
            return self.get_mock_po_lines(doc_entry)
        
        if not self.ensure_logged_in():
            logging.warning(f"‚ö†Ô∏è SAP login failed - using mock data as fallback for DocEntry {doc_entry}")
            return self.get_mock_po_lines(doc_entry)
        
        try:
            url = (
                f"{self.base_url}/b1s/v1/$crossjoin(PurchaseOrders,PurchaseOrders/DocumentLines)"
                f"?$expand=PurchaseOrders($select=CardCode,CardName,DocumentStatus,DocNum,Series,DocDate,DocDueDate,DocTotal,DocEntry),"
                f"PurchaseOrders/DocumentLines($select=LineNum,ItemCode,ItemDescription,WarehouseCode,UnitsOfMeasurment,DocEntry,LineTotal,LineStatus,Quantity,Price,PriceAfterVAT)"
                f"&$filter=PurchaseOrders/DocumentStatus eq PurchaseOrders/DocumentLines/LineStatus "
                f"and PurchaseOrders/DocEntry eq PurchaseOrders/DocumentLines/DocEntry "
                f"and PurchaseOrders/DocumentLines/DocEntry eq {doc_entry}"
            )
            
            logging.info(f"üîç Fetching PO lines using $crossjoin for DocEntry: {doc_entry}")
            response = self.session.get(url, timeout=30)
            
            if response.status_code == 200:
                data = response.json()
                crossjoin_values = data.get('value', [])
                
                if not crossjoin_values:
                    logging.warning(f"‚ö†Ô∏è No data found for DocEntry {doc_entry}")
                    return {'success': False, 'error': f'No data found for DocEntry {doc_entry}'}
                
                first_record = crossjoin_values[0]
                po_header = first_record.get('PurchaseOrders', {})
                
                document_lines = []
                open_lines = []
                for record in crossjoin_values:
                    line_data = record.get('PurchaseOrders/DocumentLines', {})
                    if line_data:
                        document_lines.append(line_data)
                        if line_data.get('LineStatus') == 'O' and line_data.get('Quantity', 0) > 0:
                            open_lines.append(line_data)
                
                po_data = {
                    **po_header,
                    'DocumentLines': document_lines,
                    'OpenLines': open_lines,
                    'TotalOpenLines': len(open_lines)
                }
                
                logging.info(f"‚úÖ Fetched PO {doc_entry} with {len(open_lines)} open lines using $crossjoin")
                return {'success': True, 'purchase_order': po_data}
            elif response.status_code == 401:
                self.session_id = None
                if self.login():
                    return self.fetch_po_lines_by_docentry(doc_entry)
                logging.warning("‚ö†Ô∏è Authentication failed - using mock data as fallback")
                return self.get_mock_po_lines(doc_entry)
            elif response.status_code == 404:
                logging.warning(f"‚ö†Ô∏è DocEntry {doc_entry} not found - using mock data as fallback")
                return self.get_mock_po_lines(doc_entry)
            else:
                error_msg = response.text
                logging.error(f"‚ùå Failed to fetch PO lines for DocEntry {doc_entry}: {error_msg}")
                logging.warning("‚ö†Ô∏è Using mock data as fallback")
                return self.get_mock_po_lines(doc_entry)
                
        except requests.exceptions.ConnectionError:
            logging.warning(f"‚ö†Ô∏è Cannot connect to SAP server - using mock data as fallback")
            return self.get_mock_po_lines(doc_entry)
        except requests.exceptions.Timeout:
            logging.warning(f"‚ö†Ô∏è SAP request timeout - using mock data as fallback")
            return self.get_mock_po_lines(doc_entry)
        except Exception as e:
            logging.error(f"‚ùå Error fetching PO lines for DocEntry {doc_entry}: {str(e)}")
            logging.warning("‚ö†Ô∏è Using mock data as fallback")
            return self.get_mock_po_lines(doc_entry)